<!-- ⭐ Toast，要放在整頁最外層 -->
<p-toast position="top-right"></p-toast>

<div class="account-page">
  <!-- Header -->
  <header class="account-header">
    <div class="account-header-text">
      <h1>Account Settings</h1>
      <p class="account-header-subtitle">管理你的個人檔案、登入資訊與頭像。</p>
    </div>

    <div class="account-header-actions">
      <button type="button" class="btn ghost" (click)="onReset()">Reset</button>

      <button
        type="button"
        class="btn primary"
        [disabled]="isSaving || form.invalid"
        (click)="onSubmit()"
      >
        {{ isSaving ? 'Saving…' : 'Save Changes' }}
      </button>
    </div>
  </header>

  <!-- Main Layout -->
  <div class="account-layout">
    <!-- 左側：Form -->
    <section class="account-main" [formGroup]="form">
      <!-- PROFILE -->
      <div class="card">
        <div class="card-header">
          <h2>Profile</h2>
          <p>更新顯示在系統中的名稱與聯絡方式。</p>
        </div>

        <div class="card-body">
          <!-- Name -->
          <div class="form-field">
            <label for="name">Name</label>
            <input id="name" type="text" formControlName="name" placeholder="Your name" />
            @if (hasError('name', 'required')) {
            <div class="field-error">Name 為必填</div>
            }
          </div>

          <!-- Email -->
          <div class="form-field">
            <label for="email">Email</label>
            <input id="email" type="email" formControlName="email" placeholder="you@example.com" />
            @if (hasError('email', 'required')) {
            <div class="field-error">Email 為必填</div>
            } @if (hasError('email', 'email')) {
            <div class="field-error">Email 格式不正確</div>
            }
          </div>
        </div>
      </div>

      <!-- SECURITY -->
      <div class="card">
        <div class="card-header">
          <h2>Security</h2>
          <p>變更登入密碼，保障你的帳號安全。</p>
        </div>

        <div class="card-body">
          <!-- Password -->
          <div class="form-field">
            <label for="password">New Password</label>
            <input
              id="password"
              type="password"
              formControlName="password"
              placeholder="至少 6 碼，留空則不修改"
            />
            @if (hasError('password', 'minlength')) {
            <div class="field-error">密碼至少 6 碼</div>
            }
            <div class="field-help">不修改密碼請留空。</div>
          </div>
        </div>
      </div>

      <!-- AVATAR -->
      <div class="card">
        <div class="card-header">
          <h2>Avatar</h2>
          <p>上傳個人頭像，右側會即時預覽。</p>
        </div>

        <div class="card-body">
          <!-- Avatar URL Field -->
          <div class="form-field">
            <label for="avatarUrl">Avatar URL</label>
            <input
              id="avatarUrl"
              type="text"
              formControlName="avatarUrl"
              placeholder="https://example.com/avatar.jpg"
            />
            <div class="field-help">你可以貼上圖片網址，或使用下方上傳。</div>

            <!-- ⭐ PrimeNG FileUpload 上傳大頭照 -->
            <p-fileUpload
              #avatarUpload
              mode="basic"
              accept="image/*"
              chooseLabel="上傳新頭像"
              [auto]="false"
              (onSelect)="onAvatarSelect($event)"
              styleClass="p-button-outlined mt-2"
            ></p-fileUpload>
          </div>
        </div>
      </div>

      <!-- Save Status -->
      <div class="save-status">
        @if (saveSuccess && !saveError) {
        <span class="success">✅ 已成功儲存設定</span>
        } @if (saveError) {
        <span class="error">{{ saveError }}</span>
        }
      </div>
    </section>

    <!-- 右側 Preview Card -->
    <aside class="account-side">
      <div class="profile-card">
        <div class="profile-avatar">
          <img [src]="avatarPreviewUrl" alt="Avatar preview" />
        </div>

        <div class="profile-info">
          <div class="profile-name">{{ displayName }}</div>
          <div class="profile-email">{{ displayEmail }}</div>
        </div>

        <div class="profile-meta">
          <span class="pill">Signed in</span>
        </div>

        <p class="profile-tip">當你修改「Name / Email / Avatar」後，這裡會即時預覽。</p>
      </div>
    </aside>
  </div>
</div>
