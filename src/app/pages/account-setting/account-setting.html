<!-- src/app/pages/account-setting/account-setting.html -->

<!-- ⭐ Toast 放在頁面最外層一次就好 -->
<p-toast position="top-right"></p-toast>

<div class="account-page">
  <header class="account-header">
    <div class="account-header-text">
      <h1>Account Settings</h1>
      <p>管理你的個人檔案、登入資訊與頭像。</p>
    </div>

    <div class="account-header-actions">
      <button type="button" class="btn ghost" (click)="onReset()">
        Reset
      </button>
      <button
        type="button"
        class="btn primary"
        [disabled]="isSaving || form.invalid"
        (click)="onSubmit()"
      >
        {{ isSaving ? 'Saving…' : 'Save Changes' }}
      </button>
    </div>
  </header>

  <div class="account-layout">
    <!-- 左側：表單 -->
    <section class="account-main" [formGroup]="form">
      <!-- Profile card -->
      <div class="card">
        <div class="card-header">
          <div>
            <h2>Profile</h2>
            <p>更新顯示在系統中的名稱與聯絡方式。</p>
          </div>
        </div>

        <div class="card-body">
          <div class="form-field">
            <label for="name">Name</label>
            <input
              id="name"
              type="text"
              formControlName="name"
              placeholder="Your name"
            />
            @if (hasError('name', 'required')) {
              <div class="field-error">Name 為必填</div>
            }
          </div>

          <div class="form-field">
            <label for="email">Email</label>
            <input
              id="email"
              type="email"
              formControlName="email"
              placeholder="you@example.com"
            />
            @if (hasError('email', 'required')) {
              <div class="field-error">Email 為必填</div>
            }
            @if (hasError('email', 'email')) {
              <div class="field-error">Email 格式不正確</div>
            }
          </div>
        </div>
      </div>

      <!-- Security card -->
      <div class="card">
        <div class="card-header">
          <div>
            <h2>Security</h2>
            <p>變更登入密碼，保障你的帳號安全。</p>
          </div>
        </div>

        <div class="card-body">
          <div class="form-field">
            <label for="password">New Password</label>
            <input
              id="password"
              type="password"
              formControlName="password"
              placeholder="至少 6 碼，留空則不修改"
            />
            @if (hasError('password', 'minlength')) {
              <div class="field-error">密碼至少 6 碼</div>
            }
            <div class="field-help">
              若不想修改密碼，可以留空，後端可忽略空值。
            </div>
          </div>
        </div>
      </div>

      <!-- Avatar card -->
      <div class="card">
        <div class="card-header">
          <div>
            <h2>Avatar</h2>
            <p>設定你的個人頭像網址，右側會即時預覽。</p>
          </div>
        </div>

        <div class="card-body">
          <div class="form-field">
            <label for="avatarUrl">Avatar URL</label>
            <input
              id="avatarUrl"
              type="text"
              formControlName="avatarUrl"
              placeholder="https://example.com/avatar.png"
            />
            <div class="field-help">
              建議使用正方形圖片，至少 160 × 160px。
            </div>
          </div>
        </div>
      </div>

      <div class="save-status">
        @if (saveSuccess && !saveError) {
          <span class="success">✅ 已成功儲存你的帳號設定</span>
        }
        @if (saveError) {
          <span class="error">{{ saveError }}</span>
        }
      </div>
    </section>

    <!-- 右側：即時預覽卡片 -->
    <aside class="account-side">
      <div class="profile-card">
        <div class="profile-avatar">
          <img [src]="avatarPreviewUrl" alt="Avatar preview" />
        </div>
        <div class="profile-info">
          <div class="profile-name">{{ displayName }}</div>
          <div class="profile-email">{{ displayEmail }}</div>
        </div>
        <div class="profile-meta">
          <span class="pill">Signed in</span>
        </div>
        <p class="profile-tip">
          修改 Name / Email / Avatar URL 時，這裡會即時更新。
        </p>
      </div>
    </aside>
  </div>
</div>
